!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("_"),require("Backbone")):"function"==typeof define&&define.amd?define(["_","Backbone"],e):"object"==typeof exports?exports.FilteredCollection=e(require("_"),require("Backbone")):t.FilteredCollection=e(t._,t.Backbone)}(this,function(t,e){return function(t){function e(s){if(i[s])return i[s].exports;var n=i[s]={exports:{},id:s,loaded:!1};return t[s].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){function s(){this._filterResultCache={}}function n(t){for(var e in this._filterResultCache)this._filterResultCache.hasOwnProperty(e)&&delete this._filterResultCache[e][t]}function r(t,e){this._filters[t]&&n.call(this,t),this._filters[t]=e,this.trigger("filtered:add",t)}function o(t){delete this._filters[t],n.call(this,t),this.trigger("filtered:remove",t)}function l(t){this._filterResultCache[t.cid]||(this._filterResultCache[t.cid]={});var e=this._filterResultCache[t.cid];for(var i in this._filters)if(this._filters.hasOwnProperty(i)&&(e.hasOwnProperty(i)||(e[i]=this._filters[i].fn(t)),!e[i]))return!1;return!0}function c(){var t=[];this._superset&&(t=this._superset.filter(p.bind(l,this))),this._collection.reset(t),this.length=this._collection.length}function h(t){if(this._filterResultCache[t.cid]={},l.call(this,t)){if(!this._collection.get(t.cid)){for(var e=this.superset().indexOf(t),i=null,s=e-1;s>=0;s-=1)if(this.contains(this.superset().at(s))){i=this.indexOf(this.superset().at(s))+1;break}i=i||0,this._collection.add(t,{at:i})}}else this._collection.get(t.cid)&&this._collection.remove(t);this.length=this._collection.length}function u(t){this._filterResultCache[t.cid]={},l.call(this,t)||this._collection.get(t.cid)&&this._collection.remove(t)}function f(t,e,i){"change:"===t.slice(0,7)&&u.call(this,arguments[1])}function a(t){this.contains(t)&&this._collection.remove(t),this.length=this._collection.length}function d(t){this._superset=t,this._collection=new _.Collection(t.toArray()),g(this._collection,this),this.resetFilters(),this.listenTo(this._superset,"reset sort",c),this.listenTo(this._superset,"add change",h),this.listenTo(this._superset,"remove",a),this.listenTo(this._superset,"all",f)}var p=i(1),_=i(2),g=i(3),v=i(4),y={defaultFilterName:"__default",filterBy:function(t,e){return e||(e=t,t=this.defaultFilterName),r.call(this,t,v(e)),c.call(this),this},removeFilter:function(t){return t||(t=this.defaultFilterName),o.call(this,t),c.call(this),this},resetFilters:function(){return this._filters={},s.call(this),this.trigger("filtered:reset"),c.call(this),this},superset:function(){return this._superset},refilter:function(t){return"object"==typeof t&&t.cid?h.call(this,t):(s.call(this),c.call(this)),this},getFilters:function(){return p.keys(this._filters)},hasFilter:function(t){return p.contains(this.getFilters(),t)},destroy:function(){this.stopListening(),this._collection.reset([]),this._superset=this._collection,this.length=0,this.trigger("filtered:destroy")}};p.extend(d.prototype,y,_.Events),t.exports=d},function(e,i){e.exports=t},function(t,i){t.exports=e},function(t,e,i){function s(t,e){function i(){e.length=t.length}function s(i){var s=n.toArray(arguments),r="change"===i||"change:"===i.slice(0,7);"reset"===i&&(e.models=t.models),n.contains(l,i)?(n.contains(["add","remove","destroy"],i)?s[2]=e:n.contains(["reset","sort"],i)&&(s[1]=e),e.trigger.apply(this,s)):r&&e.contains(s[1])&&e.trigger.apply(this,s)}var c={};return n.each(n.functions(r.Collection.prototype),function(e){n.contains(o,e)||(c[e]=function(){return t[e].apply(t,arguments)})}),n.extend(e,r.Events,c),e.listenTo(t,"all",i),e.listenTo(t,"all",s),e.models=t.models,i(),e}var n=i(1),r=i(2),o=["_onModelEvent","_prepareModel","_removeReference","_reset","add","initialize","sync","remove","reset","set","push","pop","unshift","shift","sort","parse","fetch","create","model","off","on","listenTo","listenToOnce","bind","trigger","once","stopListening"],l=["add","remove","reset","sort","destroy","sync","request","error"];t.exports=s},function(t,e,i){function s(t,e){return function(i){return i.get(t)===e}}function n(t,e){return function(i){return e(i.get(t))}}function r(t,e){return c.isArray(e)||(e=null),{fn:t,keys:e}}function o(t){var e=c.keys(t),i=c.map(e,function(e){var i=t[e];return c.isFunction(i)?n(e,i):s(e,i)}),o=function(t){for(var e=0;e<i.length;e++)if(!i[e](t))return!1;return!0};return r(o,e)}function l(t,e){return c.isFunction(t)?r(t,e):c.isObject(t)?o(t):void 0}var c=i(1);t.exports=l}])});